define("applyCampaign",["jquery","underscore","applyGoods","configInBackground","layer"],function(a,b,c,d,e){return function(){function b(b,c){this.gidList=b,this.reason=c,this.dtd=a.Deferred(),this.isApplying=!1,this.index=0,this.collectLogLayerIndex=null}return b.prototype.runApply=function(){return this.openLogLayer(),this.dtd},b.prototype.start=function(){return this.showLog("<p>\u5df2\u5f00\u59cb</p>"),this.index=0,this.isApplying=!0,this.applyGoods()},b.prototype.openLogLayer=function(){var b,c;return b="<div id='qtk_flagship_apply_logs' style='display: none'><div class='qtk-log-wrap'></div></div>",c=a("#qtk_flagship_apply_logs"),c.length<1&&a("body").append(b),this.collectLogLayerIndex=e.open({type:1,title:"\u6279\u91cf\u7533\u8bf7\u63a8\u5e7f\u8ba1\u5212",content:a("#qtk_flagship_apply_logs"),closeBtn:!0,shade:!1,area:["1000px","400px"],shift:2,maxmin:!0,success:function(b){return function(){if(!b.isCollecting)return a(".qtk-log-wrap").html(""),b.start()}}(this),end:function(a){return function(){return a.collectLogLayerIndex=null}}(this)})},b.prototype.restore=function(){if(this.isApplying)return this.collectLogLayerIndex?e.restore(this.collectLogLayerIndex):this.collectLogLayerIndex=e.open({type:1,title:"\u6279\u91cf\u7533\u8bf7\u63a8\u5e7f\u8ba1\u5212",content:a("#qtk_flagship_apply_logs"),closeBtn:!0,shade:!1,area:["1000px","400px"],shift:2,maxmin:!0,end:function(a){return function(){return a.collectLogLayerIndex=null}}(this)})},b.prototype.showLog=function(b){return a(".qtk-log-wrap").prepend(b)},b.prototype.applyGoods=function(){var a,b,d;return this.index>=this.gidList.length?(this.onFinish(),!0):(d=this.gidList[this.index],a=new c(this.reason),b=a.runApply(d),b.progress(function(a){return function(b){return a.onProgress(b)}}(this)),b.fail(function(a){return function(b){var c;return d=b.gid,c=b.e,1===c?a.showLog("<p class='success'><span class='item-number'>"+(a.index+1)+"/"+a.gidList.length+"</span>\u5546\u54c1\u3010<a target='_blank' href='http://item.taobao.com/item.htm?id="+b.gid+"'>"+b.gid+"</a>\u3011\u6ca1\u6709\u63a8\u5e7f\u8ba1\u5212\u6216\u53ea\u6709\u65e0\u9700\u7533\u8bf7\u7684\u901a\u7528\u8ba1\u5212\uff01</p>"):a.showLog("<p class='error'><span class='item-number'>"+(a.index+1)+"/"+a.gidList.length+"</span>\u7533\u8bf7\u5546\u54c1\u3010<a target='_blank' href='http://item.taobao.com/item.htm?id="+b.gid+"'>"+b.gid+"</a>\u3011\u7684\u63a8\u5e7f\u8ba1\u5212\u5931\u8d25\uff01</p>"),a.dtd.notify({gid:d,e:!0}),a.index++,a.applyGoods()}}(this)),b.done(function(a){return function(){return a.dtd.notify({gid:d,e:!1}),a.index++,a.applyGoods()}}(this)))},b.prototype.onFinish=function(){return this.showLog("<p>\u5df2\u5b8c\u6210</p>"),this.isApplying=!0,this.dtd.resolve(!0)},b.prototype.onProgress=function(a){var b,c,d,e,f,g;return d=a.detail,b=a.campaign,f=a.result,c=a.gid,g=a.seller,e="",e=f?"<p class='success'><span class='item-number'>"+(this.index+1)+"/"+this.gidList.length+"</span>\u5546\u54c1\u3010<a target='_blank' href='http://item.taobao.com/item.htm?id="+c+"'>"+d.title+"</a>\u3011\u7684\u63a8\u5e7f\u8ba1\u5212\uff1a <a target='_blank' href='http://pub.alimama.com/myunion.htm?#!/promo/self/campaign?campaignId="+b.campaignId+"&shopkeeperId="+b.shopKeeperId+"&userNumberId="+g.userNumId+"'>"+b.campaignName+"</a>\u5df2\u7ecf\u7533\u8bf7\u8fc7\uff0c\u65e0\u9700\u518d\u6b21\u7533\u8bf7</p>":"<p class='success'><span class='item-number'>"+(this.index+1)+"/"+this.gidList.length+"</span>\u5df2\u7533\u8bf7\u5546\u54c1\u3010<a target='_blank' href='http://item.taobao.com/item.htm?id="+c+"'>"+d.title+"</a>\u3011\u7684\u63a8\u5e7f\u8ba1\u5212\uff1a <a target='_blank' href='http://pub.alimama.com/myunion.htm?#!/promo/self/campaign?campaignId="+b.campaignId+"&shopkeeperId="+b.shopKeeperId+"&userNumberId="+g.userNumId+"'>"+b.campaignName+"</a></p>",this.showLog(e)},b}()});