define("collectAlimamaGoods",["jquery","underscore","alimama","goodsIsTmall"],function(a,b,c,d){return function(){function e(){this.dtd=a.Deferred(),this.page=1,this.originUrl=window.location.hash,this.alimama=new c,this.goodsList=[]}return e.prototype.get=function(a){return this.pageCount=a,this.getGoods(),this.dtd},e.prototype.getGoods=function(){var a,c;return this.page>this.pageCount?(this.dtd.resolve(this.goodsList),!0):(c=this.originUrl,c=c.replace(/#!\/promo\/self\/items\??/gi,""),c=c.replace(/[&?]toPage=\d*/gi,""),c=c.replace(/[&?]perPagesize=\d*/gi,""),c=c.replace(/[&?]_input_charset=utf-8/gi,""),c+="&toPage="+this.page,c+="&perPagesize=40&_input_charset=utf-8",a=this.alimama.collectGoods(c),a.fail(function(a){return function(){return a.page++,a.getGoods()}}(this)),a.done(function(c){return function(e){var f,g,h,i,j,k;if(k=e.pagelist,f=[],b.isArray(k))for(i=0,j=k.length;i<j;i++)g=k[i],f.push(g.auctionId+"");return f.length<1?(c.page++,c.getGoods(),!1):(h=new d(f),a=h.get(),a.done(function(a){var b,d,f;for(b=0,d=k.length;b<d;b++)g=k[b],g.isTmall=!!a[g.auctionId+""],c.dtd.notify(g),c.goodsList.push(g);return!(f=e.paginator)||c.page>=f.lastPage?(c.dtd.resolve(c.goodsList),!1):(c.page++,c.getGoods())}))}}(this)))},e}()});