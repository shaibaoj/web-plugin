define("collectTaobaoSearch",["jquery","underscore","configInBackground","layer","getTaobaoWaitCollectGoods","getMultipleGoodsCommission","common","qtkApi","config"],function(a,b,c,d,e,f,g,h,i){return function(){function b(){this.bindEvent(),this.isCollecting=!1,this.waitFilterGoodsList=[],this.filteredGoodsList=[]}return b.prototype.bindEvent=function(){return a("#qtk_flagship_collect_goods").click(function(a){return function(){return a.onClick()}}(this)),a(document).on("click","#qtk_flagship_collect_start",function(a){return function(){return a.onStartClick()}}(this)),a(window).on("beforeunload",function(a){return function(){return a.onBeforeUnload()}}(this))},b.prototype.onBeforeUnload=function(){if(this.isCollecting)return"\u6b63\u5728\u6279\u91cf\u91c7\u96c6\u5546\u54c1\u4e2d"},b.prototype.onStartClick=function(){return this.commission=parseFloat(a("#qtk_flagship_collect_commission").val())||0,this.pageCount=parseFloat(a("#qtk_flagship_collect_page").val())||1,this.dsr=parseFloat(a("#qtk_flagship_collect_dsr").val())||0,this.shopLevel=parseInt(a("#qtk_flagship_collect_level").val())||1,this.pageCount>100&&(this.pageCount=100),this.configLayerIndex&&d.close(this.configLayerIndex),this.openLogLayer()},b.prototype.openLogLayer=function(){var b,c;return b="<div id='qtk_flagship_collect_logs' style='display: none'><div class='qtk-log-wrap'></div></div>",c=a("#qtk_flagship_collect_logs"),c.length<1&&a("body").append(b),this.collectLogLayerIndex=d.open({type:1,skin:"layui-layer-modal",title:'<i class="pageIcon7"></i>\u6279\u91cf\u91c7\u96c6',content:a("#qtk_flagship_collect_logs"),closeBtn:!0,shade:!1,area:["800px","400px"],shift:2,maxmin:!0,success:function(b){return function(){if(!b.isCollecting)return a(".qtk-log-wrap").html(""),b.start()}}(this),end:function(a){return function(){return a.collectLogLayerIndex=null}}(this)})},b.prototype.start=function(){var a,b;return this.isCollecting=!0,this.filteredGoodsList=[],this.filterId=g.guid(),this.showLog('<p class="start">\u5df2\u5f00\u59cb\uff0c\u6b63\u5728\u83b7\u53d6\u5546\u54c1\u4e2d\u2026\u2026</p>'),b=new e,a=b.get(this.pageCount),a.fail(function(a){return function(){return a.showLog('<p class="fail">\u83b7\u53d6\u5546\u54c1\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01</p>')}}(this)),a.done(function(a){return function(b){return a.onGetWaitFilterGoods(b)}}(this))},b.prototype.onGetWaitFilterGoods=function(a){var b,c,d,e,g,h,i,j,k;for(this.showLog("<p>\u5171\u83b7\u53d6\u5230"+a.length+"\u6b3e\u9700\u8981\u7b5b\u9009\u7684\u5546\u54c1</p>"),this.waitFilterGoodsList=a,g=[],j=this.waitFilterGoodsList,h=0,i=j.length;h<i;h++)e=j[h],k=e.shopcard,e.raw_title&&(k?!k.isTmall&&k.sellerCredit<this.shopLevel?this.showLog("<p class='be-filtered'><a href='"+e.detail_url+"' target='_blank'>"+e.raw_title+"</a>\u56e0\u5e97\u94fa\u7b49\u7ea7\u8fc7\u4f4e\u88ab\u8fc7\u6ee4</p>"):(c=(k.description[0]||0)/100,c<this.dsr?this.showLog("<p class='be-filtered'><a href='"+e.detail_url+"' target='_blank'>"+e.raw_title+"</a>\u56e0\u5e97\u94fa\u63cf\u8ff0\u8bc4\u5206\u8fc7\u4f4e\u88ab\u8fc7\u6ee4</p>"):g.push(e.nid)):this.showLog("<p class='be-filtered'><a href='"+e.detail_url+"' target='_blank'>"+e.raw_title+"</a>\u56e0\u5e97\u94fa\u7b49\u7ea7\u8fc7\u4f4e\u88ab\u8fc7\u6ee4</p>"));return d=new f(g),b=d.start(),b.done(function(a){return function(){return a.onFilterFinish()}}(this)),b.progress(function(a){return function(b){return a.onProgress(b)}}(this))},b.prototype.onProgress=function(a){var b,c,d,e,f,g,h,i;for(a.index,d=a.goods,b=a.auctionId,c=null,h=this.waitFilterGoodsList,f=0,g=h.length;f<g;f++)if(i=h[f],i.nid+""==b+""){c=i;break}return!d||d.commissionRatePercent<this.commission?(this.showLog("<p class='be-filtered'><a href='"+c.detail_url+"' target='_blank'>"+c.raw_title+"</a>\u56e0\u4f63\u91d1\u6bd4\u4f8b\u8fc7\u4f4e\u88ab\u8fc7\u6ee4</p>"),!1):(e="<p class='success'><a href='"+c.detail_url+"' target='_blank'>"+c.raw_title+"</a>\u7b26\u5408\u6761\u4ef6\u3002\u4f63\u91d1\u6bd4\u4f8b\uff1a<span class='commission'>"+d.commissionRatePercent+"%</span></p>",this.showLog(e),this.filteredGoodsList.push({search:c,alimama:d}))},b.prototype.onFilterFinish=function(){return this.filteredGoodsList.length<1?(this.isCollecting=!1,this.showLog("<p>\u6ca1\u6709\u7b26\u5408\u60a8\u8bbe\u7f6e\u6761\u4ef6\u7684\u5546\u54c1\u3002\u672c\u6b21\u91c7\u96c6\u5df2\u7ed3\u675f</p>"),!1):(this.showLog('<p class="status">\u5df2\u5b8c\u6210\u7b5b\u9009\u3002\u5171<span class="filtered-num">'+this.filteredGoodsList.length+"</span>\u6b3e\u5546\u54c1\u7b26\u5408\u60a8\u7684\u6761\u4ef6\uff0c\u6b63\u5728\u4fdd\u5b58\u7b5b\u9009\u7ed3\u679c\u2026\u2026</p>"),this.saveFilteredGoods())},b.prototype.saveFilteredGoods=function(){var a,b,c,e,f,g,j,k;for(c=[],k=this.filteredGoodsList,e=0,g=k.length;e<g;e++)b=k[e],f={goodsId:b.alimama.auctionId,biz30day:b.alimama.biz30day,totalFee:b.alimama.totalFee,totalNum:b.alimama.totalNum,commision:b.alimama.calCommission,commissionRatePercent:b.alimama.commissionRatePercent,istmall:b.search.shopcard.isTmall?1:0,title:b.alimama.title,price:b.alimama.zkPrice,picUrl:b.alimama.pictUrl,comeFrom:1},c.push(f);return j=new h,a=j.saveCollectGoods(c),a.fail(function(a){return function(b){return a.isCollecting=!1,a.showLog("<p>\u4fdd\u5b58\u91c7\u96c6\u7ed3\u679c\u5931\u8d25\u3002\u8bf7\u91cd\u8bd5\uff011</p>")}}(this)),a.done(function(a){return function(b){return a.isCollecting=!1,a.showLog("<p>\u5df2\u5b8c\u6210</p>"),d.alert("\u5df2\u91c7\u96c6\u5b8c\u6210\uff0c<a style='color: #f40;' target='_blank' href='"+i.qtkHost+"caiji'>\u70b9\u6211\u67e5\u770b\u91c7\u96c6\u7ed3\u679c</a>",{btn:"\u5173\u95ed"})}}(this))},b.prototype.showLog=function(b){return a(".qtk-log-wrap").prepend(b)},b.prototype.onClick=function(){var b,e;return b=new c,e=a.when(b.get("isLoginAlimama"),b.get("isValid")),e.done(function(a){return function(b,c){return b?a.openConfigLayer():d.alert('\u8bf7\u767b\u5f55\u6dd8\u5b9d\u8054\u76df\u3002<a target="_blank" style="color: #f40;" href="http://www.alimama.com">\u7acb\u5373\u767b\u5f55</a>')}}(this))},b.prototype.openConfigLayer=function(){var b,c;return this.isCollecting?(this.collectLogLayerIndex?d.restore(this.collectLogLayerIndex):this.openLogLayer(),!0):(this.collectLogLayerIndex&&d.close(this.collectLogLayerIndex),c='<div id="qtk_flagship_collect_config" style="display: none"><div class="config-wrap"> <div class="line"> <span class="commission">\u4f63\u91d1\u6bd4\u4f8b\u2265</span><input type="text" value="0" id="qtk_flagship_collect_commission"/>% <span class="page-count">\u5171\u91c7\u96c6</span><input type="text" value="1" id="qtk_flagship_collect_page"/>\u9875 </div> <div class="line"> <span class="level">\u5e97\u94fa\u4fe1\u8a89\u2265</span><select id="qtk_flagship_collect_level"> <option selected value="1">\u4e00\u5fc3</option> <option value="2">\u4e8c\u5fc3</option> <option value="3">\u4e09\u5fc3</option> <option value="4">\u56db\u5fc3</option> <option value="5">\u4e94\u5fc3</option> <option value="6">\u4e00\u94bb</option> <option value="7">\u4e8c\u94bb</option> <option value="8">\u4e09\u94bb</option> <option value="9">\u56db\u94bb</option> <option value="10">\u4e94\u94bb</option> <option value="11">\u4e00\u7687\u51a0</option> <option value="12">\u4e8c\u7687\u51a0</option> <option value="13">\u4e09\u7687\u51a0</option> <option value="14">\u56db\u7687\u51a0</option> <option value="15">\u4e94\u7687\u51a0</option> <option value="16">\u4e00\u91d1\u51a0</option> <option value="17">\u4e8c\u91d1\u51a0</option> <option value="18">\u4e09\u91d1\u51a0</option> <option value="19">\u56db\u91d1\u51a0</option> <option value="20">\u4e94\u91d1\u51a0</option> </select> <span class="dsr">\u8bc4\u5206\u2265</span><input type="text" value="0" id="qtk_flagship_collect_dsr"/> </div> <div class="line"><button id="qtk_flagship_collect_start">\u5f00\u59cb\u91c7\u96c6</button></div> </div></div>',b=a("#qtk_flagship_collect_config"),b.length<1&&a("body").append(c),this.configLayerIndex=d.open({type:1,skin:"layui-layer-modal",title:'<i class="pageIcon7"></i>\u6279\u91cf\u91c7\u96c6\u53c2\u6570\u8bbe\u7f6e',content:a("#qtk_flagship_collect_config"),closeBtn:!0,shade:!1,area:"400px",shift:2,maxmin:!0,success:function(){},end:function(a){return function(){return a.configLayerIndex=null}}(this)}))},b}()});