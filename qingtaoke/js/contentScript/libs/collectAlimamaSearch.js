define("collectAlimamaSearch",["jquery","underscore","common","layer","collectAlimamaGoods","qtkApi","config"],function(a,b,c,d,e,f,g){return function(){function b(){this.isCollecting=!1,this.bindEvent()}return b.prototype.bindEvent=function(){return a(document).on("click","#qtk_flagship_alimama_goods",function(a){return function(){return a.onClick()}}(this)),a(window).on("beforeunload",function(a){return function(){return a.onBeforeUnload()}}(this)),a(document).on("click","#qtk_flagship_collect_start",function(a){return function(){return a.onStartClick()}}(this))},b.prototype.onBeforeUnload=function(){if(this.isCollecting)return"\u6b63\u5728\u6279\u91cf\u91c7\u96c6\u5546\u54c1\u4e2d"},b.prototype.onStartClick=function(){return this.pageCount=parseFloat(a("#qtk_flagship_collect_page").val())||1,this.configLayerIndex&&d.close(this.configLayerIndex),this.openLogLayer()},b.prototype.openLogLayer=function(){var b,c;return b="<div id='qtk_flagship_collect_logs' style='display: none'><div class='qtk-log-wrap'></div></div>",c=a("#qtk_flagship_collect_logs"),c.length<1&&a("body").append(b),this.collectLogLayerIndex=d.open({type:1,title:"\u6279\u91cf\u91c7\u96c6",content:a("#qtk_flagship_collect_logs"),closeBtn:!0,shade:!1,area:["800px","400px"],shift:2,maxmin:!0,success:function(b){return function(){if(!b.isCollecting)return a(".qtk-log-wrap").html(""),b.start()}}(this),end:function(a){return function(){return a.collectLogLayerIndex=null}}(this)})},b.prototype.start=function(){var a,b;return this.isCollecting=!0,this.filteredGoodsList=[],this.filterId=c.guid(),this.showLog('<p class="start">\u5df2\u5f00\u59cb\uff0c\u6b63\u5728\u91c7\u96c6\u4e2d\u2026\u2026</p>'),a=new e,b=a.get(this.pageCount),b.progress(function(a){return function(b){return a.onProgress(b)}}(this)),b.done(function(a){return function(b){return a.filteredGoodsList=b,a.onCollectGoods()}}(this))},b.prototype.onProgress=function(a){var b;return b="<p class='success'>\u5df2\u91c7\u96c6\u5230\u5546\u54c1\u3010<a href='"+a.auctionUrl+"' target='_blank'>"+a.title+"</a>\u3011\u3002\u4f63\u91d1\u6bd4\u4f8b\uff1a<span class='commission'>"+a.commissionRatePercent+"%</span></p>",this.showLog(b)},b.prototype.onCollectGoods=function(){return this.showLog("<p>\u5171\u91c7\u96c6\u5230"+this.filteredGoodsList.length+"\u6b3e\u5546\u54c1\u3002\u6b63\u5728\u4fdd\u5b58\u5546\u54c1\u4e2d\u2026\u2026</p>"),this.saveFilteredGoods()},b.prototype.saveFilteredGoods=function(){var a,b,c,e,h,i,j,k;for(c=[],k=this.filteredGoodsList,e=0,i=k.length;e<i;e++)b=k[e],h={goodsId:b.auctionId,biz30day:b.biz30day,totalFee:b.totalFee,totalNum:b.totalNum,commision:b.calCommission,commissionRatePercent:b.commissionRatePercent,istmall:b.isTmall?1:0,title:b.title,price:b.zkPrice,picUrl:b.pictUrl,comeFrom:1},c.push(h);return j=new f,a=j.saveCollectGoods(c),a.fail(function(a){return function(b){return a.isCollecting=!1,a.showLog("<p>\u4fdd\u5b58\u91c7\u96c6\u7ed3\u679c\u5931\u8d25\u3002\u8bf7\u91cd\u8bd5\uff011</p>")}}(this)),a.done(function(a){return function(b){return a.isCollecting=!1,a.showLog("<p>\u5df2\u5b8c\u6210</p>"),d.alert("\u5df2\u91c7\u96c6\u5b8c\u6210\uff0c<a style='color: #f40;' target='_blank' href='"+g.qtkHost+"caiji'>\u70b9\u6211\u67e5\u770b\u91c7\u96c6\u7ed3\u679c</a>",{btn:"\u5173\u95ed"})}}(this))},b.prototype.onClick=function(){return this.openConfigLayer()},b.prototype.showLog=function(b){return a(".qtk-log-wrap").prepend(b)},b.prototype.openConfigLayer=function(){var b,c;return"#!/promo/self/items"===window.location.hash||"#!/promo/self/items?"===window.location.hash?(d.alert("\u8bf7\u641c\u7d22\u540e\u91c7\u96c6"),!1):this.isCollecting?(this.collectLogLayerIndex?d.restore(this.collectLogLayerIndex):this.openLogLayer(),!0):(this.collectLogLayerIndex&&d.close(this.collectLogLayerIndex),c='<div id="qtk_flagship_collect_config" style="display: none"><div class="config-wrap"> <div class="line"> <span class="page-count">\u5171\u91c7\u96c6</span><input type="text" value="1" id="qtk_flagship_collect_page"/>\u9875 </div> <div class="line"><button id="qtk_flagship_collect_start">\u5f00\u59cb\u91c7\u96c6</button></div> </div></div>',b=a("#qtk_flagship_collect_config"),b.length<1&&a("body").append(c),this.configLayerIndex=d.open({type:1,title:"\u6279\u91cf\u91c7\u96c6\u53c2\u6570\u8bbe\u7f6e",content:a("#qtk_flagship_collect_config"),closeBtn:!0,shade:!1,area:["400px","166px"],shift:2,maxmin:!0,success:function(){},end:function(a){return function(){return a.configLayerIndex=null}}(this)}))},b}()});