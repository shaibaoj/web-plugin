define("copyPicture",["jquery","underscore","layer","qtkApi","configInBackground"],function(a,b,c,d,e){return function(){function b(){this.panelTimer=null,this.currentImg=null,this.init()}return b.prototype.init=function(){var b,c;return c=this,b=new e,a.when(b.get("defaultSkin")).done(function(b){return function(d){var e,f;return f="layer-color-"+d,e=b.copyPanel(f),a("body").append(e),a(e).on("mouseenter",function(){return clearTimeout(c.panelTimer),a(e).show()}),a(e).on("mouseleave",function(){return a(e).hide()}),b.copyMainPic(e),b.copyListPic(e),b.copyUrl(),b.copyPic()}}(this))},b.prototype.copyMainPic=function(b){var c;return c=this,a(".tb-booth").on("mouseenter",function(){var d,e,f,g;return clearTimeout(c.panelTimer),window.getSelection().removeAllRanges(),/tmall/i.test(window.location.hostname)?(e=a("div.tb-booth").offset().top,d=a("div.tb-booth").offset().left-a(b).width()-10):(e=a("div.tb-main-pic").offset().top,d=a("div.tb-item-info-l").offset().left-a(b).width()-10),a(b).css({top:e+"px",left:d+"px"}),a(b).show(),g=/\.jpg/.exec(a("img#J_ImgBooth").attr("src")),null===g?(a('[name="qtk_wait_copy"]').val(""),!1):(f=g.input.substring(0,g.index+4),a('[name="qtk_wait_copy"]').val(f),c.currentImg=event.target)}),a(".tb-booth").on("mouseleave",function(){return window.getSelection().removeAllRanges(),c.panelTimer=setTimeout(function(){return a(b).hide()},500)})},b.prototype.copyListPic=function(b){var c;return c=this,a(document).on("mouseenter","#description > div.content img",function(d){var e,f,g,h;if(window.getSelection().removeAllRanges(),"IMG"===d.target.nodeName.toUpperCase())return clearTimeout(c.panelTimer),f=a(this).offset().top,e=a(this).offset().left+a(this).width()+10,a(b).css({top:f+"px",left:e+"px"}),a(b).show(),h=/\.jpg/.exec(a(this).attr("src")),g=h.input.substring(0,h.index+4),a('[name="qtk_wait_copy"]').val(g),c.currentImg=d.target}),a(document).on("mouseleave","#description > div.content img",function(d){if(window.getSelection().removeAllRanges(),"IMG"===d.target.nodeName.toUpperCase())return c.panelTimer=setTimeout(function(){return a(b).hide()},500)})},b.prototype.copyPanel=function(b){var c;return c=new Array,c.push('<div class="qtk_copy_box '+b+'"><ul>'),c.push('  <li><a href="javascript:;" class="qtk_copy_Pic">\u590d\u5236\u56fe\u7247</a></li>'),c.push('  <li><a href="javascript:;" class="qtk_copy_Url">\u590d\u5236\u56fe\u7247\u5730\u5740</a></li>'),c.push('  <li class="qtk_wait_copy"><input type="text" name="qtk_wait_copy"></li>'),c.push("</ul></div>"),a(c.join("\n"))},b.prototype.copyPic=function(){return this,a(document).on("click",".qtk_copy_Pic",function(){var b,d,e,f,g;return g=a('[name="qtk_wait_copy"]').val(),g=g.replace(/.*?\/\/.*?\//,"//imgproxy.qingtaoke.com/"),b=/^http:/.test(g),d=/^https:/.test(g),!1===b&&!1===d?g="http:"+g:!1===b&&!0===d&&(g=g.replace(/^https/,"http")),g=g.replace(/[A-Z]/g,function(a){return"*"+a.toLowerCase()}),a("body").append('<img src="'+g+'" class="qtk_wait_copyPic">'),f=document.createRange(),e=a("img.qtk_wait_copyPic")[0],f.selectNode(e),window.getSelection().addRange(f),document.execCommand("copy"),window.getSelection().removeAllRanges(),c.msg("\u590d\u5236\u6210\u529f"),a("img.qtk_wait_copyPic").remove()})},b.prototype.copyUrl=function(){return a(document).on("click",".qtk_copy_Url",function(){return""===a('[name="qtk_wait_copy"]').val()?c.msg("\u590d\u5236\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u590d\u5236"):(a('[name="qtk_wait_copy"]').select(),document.execCommand("Copy",!1,""),c.msg("\u590d\u5236\u6210\u529f"))})},b}()});