define("alimamaSearch",["jquery","underscore","configInBackground","layer","collectAlimamaSearch","storage","keyboard"],function(a,b,c,d,e,f,g){return function(){function b(){this.kb=new g,this.referer=document.referrer,this.isAuto=0,/https?:\/\/[^\s]*?(taobao\.com|tmall\.com|95095\.com)[^\s]*?(\?|&|&amp;)id=\d+/.test(this.referer)&&(this.isAuto=1,this.startAuto())}return b.prototype.bindHashChange=function(){var b;return b=/^#!\/promo\/self\/items/i,b.test(window.location.hash)&&this.onSearchPage(),a(window).on("hashchange",function(a){return function(){return b.test(window.location.hash)?a.onSearchPage():a.closeMenu()}}(this))},b.prototype.startAuto=function(){var b;return b=setInterval(function(c){return function(){var d;if(d=a(".block-search-box a.box-btn-left"),d.length>0)return clearInterval(b),setTimeout(function(){if(!/f=qtk/gi.test(document.location.search))return c.click(a(".block-search-box a.box-btn-left")[0])},500)}}(this),500)},b.prototype.clickSubmit=function(){var b;return b=setInterval(function(c){return function(){var d;if(d=a("button[mx-click=submit]"),d.length>0)return clearInterval(b),setTimeout(function(){return c.click(a("button[mx-click=submit]")[0]),c.toShortLink()},500)}}(this),500)},b.prototype.click=function(a){var b;return b=document.createEvent("MouseEvents"),b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(b)},b.prototype.closeMenu=function(){if(this.kb.unBindEvent(),this.kb.unsetDefault(),this.menuLayerIndex)return d.close(this.menuLayerIndex)},b.prototype.onSearchPage=function(){var b;return this.kb.unBindEvent(),this.kb.bindEvent(),this.kb.on("menuShortcut",function(b){return function(){return b.menuLayerIndex?d.close(b.menuLayerIndex):b.menuLayerIndex=d.open({type:1,title:"\u8f7b\u6dd8\u5ba2\u65d7\u8230\u7248",content:a("#qtk_flagship_menu"),shade:!1,offset:[b.menuPositionTop,b.menuPositionLeft],area:"280px",closeBtn:!1,maxmin:!0,shift:2,moveEnd:function(){return b.onMoveEnd()},success:function(){return b.bindEvent()},end:function(){return b.menuLayerIndex=null}})}}(this)),b=this.showMenu(),b.done(function(a){return function(){return a.bindEvent()}}(this))},b.prototype.bindEvent=function(){if(!this.collectAlimamaSearch)return this.collectAlimamaSearch=new e},b.prototype.showMenu=function(){var b,e,f;return f=a.Deferred(),b=new c,e=a.when(b.get("username"),b.get("expired"),b.get("isUnavailable"),b.get("menuPositionTop"),b.get("menuPositionLeft"),b.get("isDefaultShowMenu")),e.done(function(b){return function(c,e,g,h,i,j){var k,l;return b.menuPositionTop=h,b.menuPositionLeft=i,b.isDefaultShowMenu=j,c&&e&&!g?(k='<div id="qtk_flagship_menu" style="display: none"> <div class="username-wrap"> <div class="username">'+c+'</div> <div class="invalid-date">'+e+'</div> </div> <ul class="menu"> <li id="qtk_flagship_alimama_goods">\u6279\u91cf\u91c7\u96c6\u5546\u54c1</li> <li style="display: none" id="qtk_flagship_short_url">\u8f6c\u77ed\u7f51\u5740</li> <li><a target="_blank" href="http://www.qingtaoke.com/collect">\u6211\u7684\u6536\u85cf</a></li> <li><a target="_blank" href="http://www.qingtaoke.com/lianjiezhuanhuan">\u6279\u91cf\u94fe\u63a5\u8f6c\u6362</a></li> <li><a style="display: none" target="_blank" href="#">\u6279\u91cf\u7533\u8bf7\u63a8\u5e7f\u8ba1\u5212</a></li> <li><a target="_blank" href="http://queqiao.qingtaoke.com/search">\u641c\u7d22\u9e4a\u6865\u5546\u54c1</a></li> <li><a target="_blank" href="http://bbs.qingtaoke.com/forum.php?gid=43">\u5e2e\u52a9\u4e2d\u5fc3</a></li> </ul> </div>',l=a("#qtk_flagship_menu"),l.length<1&&a("body").append(k),"1"===b.isDefaultShowMenu?b.menuLayerIndex=d.open({type:1,title:"\u8f7b\u6dd8\u5ba2\u65d7\u8230\u7248",content:a("#qtk_flagship_menu"),shade:!1,offset:[b.menuPositionTop,b.menuPositionLeft],area:"280px",closeBtn:!1,maxmin:!0,shift:2,moveEnd:function(){return b.onMoveEnd()},success:function(a,b){return f.resolve(!0)},end:function(){return b.menuLayerIndex=null}}):void 0):(f.reject(!1),!1)}}(this)),f},b.prototype.onMoveEnd=function(){var b,d,e,g,h,i,j,k;return d=a("#layui-layer"+this.menuLayerIndex),h=a(d).offset(),k=a(window).width(),g=a(window).height(),i=new f,j=h.top,j<0&&(j=50),j>g-200&&(j=g-200),j+="px",e=parseInt(h.left/k*100),e>80&&(e=80),e<0&&(e=0),e+="%",this.menuPositionTop=j,this.menuPositionLeft=e,i.set("menuPositionTop",j),i.set("menuPositionLeft",e),b=new c,b.set("menuPositionTop",j),b.set("menuPositionLeft",e)},b}()});