define("alimama",["jquery","underscore","common","config","errorCode","alimamaQueue"],function(a,b,c,d,e,f){return function(){function g(a,b,c){this.token=a,this.h5=b,this.h5Enc=c}return g.prototype.getAliData=function(c){var g,h,i,j,k,l,m;k="GET",h=null;for(j in arguments)m=arguments[j],b.isString(m)&&"post"===m.toLowerCase()&&(k="POST"),b.isObject(m)&&(h=m);return i=a.Deferred(),l={dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest"},method:k},h&&(l.data=h),g=f.push(c,l),g.fail(function(a){return function(a){var b;return 200===a.status&&(b=a.responseText,/\u6dd8\u5b9d\u4f1a\u5458/i.test(b))?(d.isLoginAlimama&&(d.tkMemberId=null,d.tkRank=null,d.tkNickname=null,d.pidList=[]),i.reject({errorCode:e.ERROR_ALIMAMA_LOGOUT,errorText:'\u6ca1\u6709\u767b\u5f55\u6dd8\u5b9d\u8054\u76df\u6216\u5df2\u9000\u51fa\u6dd8\u5b9d\u8054\u76df\u3002<br/><a target="_blank" href="http://www.alimama.com/member/login.htm">\u70b9\u6211\u53bb\u767b\u5f55\u6dd8\u5b9d\u8054\u76df</a>'}),!1):i.reject({errorCode:e.ERROR_NETWORK,errorText:"\u7f51\u7edc\u9519\u8bef\u6216\u670d\u52a1\u5668\u9519\u8bef"})}}()),g.done(function(a){return function(a){return 5===a.wait?(i.reject({errorCode:e.ERROR_ALIMAMA_API,errorText:"\u7f51\u7edc\u9519\u8bef\u6216\u670d\u52a1\u5668\u9519\u8bef"}),!1):a.ok&&a.info.ok?a.data&&a.data.imgUrl?(i.reject({errorCode:e.ERROR_ALIMAMA_VERIFY_CODE,errorText:"\u6dd8\u5b9d\u8054\u76df\u8981\u6c42\u8f93\u5165\u9a8c\u8bc1\u7801"}),!1):i.resolve(a.data):(i.reject({errorCode:e.ERROR_ALIMAMA_PLAN,errorText:a.info.message}),!1)}}()),i},g.prototype.searchAuction=function(b){var e,f,g,h;return g=a.Deferred(),e=encodeURIComponent("https://item.taobao.com/item.htm?id="+b),h="http://pub.alimama.com/items/search.json?q="+e+"&auctionTag=&perPageSize=40&shopTag=",f=this.getAliData(h),f.fail(function(a){return c.log("d fail searchAuction"),c.log(a),g.reject(a)}),f.done(function(a){return function(b){return c.log("d done searchAuction"),c.log(b),b.pageList&&b.pageList.length>0?(setTimeout(function(){var b;return b=a.getUnionContextInfo(),b.done(function(a){var b;if(d.tkMemberId=a.memberid,d.tkNickname=a.mmNick,b=d.pidListAll[d.tkMemberId+""])return d.pidList=b})},0),g.resolve(b.pageList[0])):g.resolve(null)}}(this)),g},g.prototype.magpieDetail=function(b){var d,e,f,g,h;return f=a.Deferred(),d=encodeURI("https://item.taobao.com/item.htm?id="+b),g=(new Date).getTime(),h="http://pub.alimama.com/items/channel/qqhd.json?q="+d+"&channel=qqhd&_t="+g+"&perPageSize=50&shopTag=",e=this.getAliData(h),e.fail(function(a){return c.log(a),f.reject(a)}),e.done(function(a){return function(a){return a.pageList&&a.pageList.length>0?f.resolve(a.pageList[0]):f.resolve(null)}}()),f},g.prototype.goodsDetail=function(b){var d,f;return f="http://hws.m.taobao.com/cache/wdetail/5.0/?id="+b,c.log("goodsDetail"+f),d=a.Deferred(),a.ajax(f,{dataType:"json",headers:{"x-forwarded-for":this.getRandIp()},error:function(){return d.reject({errorCode:e.ERROR_NETWORK,errorText:"\u7f51\u7edc\u9519\u8bef\u6216\u670d\u52a1\u5668\u9519\u8bef"})},success:function(a){var b;return b=a.ret[0],/^SUCCESS::/i.test(b)?d.resolve(a.data):(d.reject({errorCode:e.ERROR_GOODS_NOT_EXISTS,errorText:"\u8be5\u5546\u54c1\u4e0d\u5b58\u5728"}),!1)}}),d},g.prototype.convertLink=function(a,b,c){var d;return d="http://pub.alimama.com/common/code/getAuctionCode.json?auctionid="+a+"&adzoneid="+c+"&siteid="+b+"&_input_charset=utf-8",this.getAliData(d)},g.prototype.applyCampaign=function(b,d,e){var f,g,h,i;return c.log("applyCampaign"),i="http://pub.alimama.com/pubauc/applyForCommonCampaign.json",g={campId:b,keeperid:d,applyreason:e,_tb_token_:this.token},h=a.Deferred(),f=this.getAliData(i,g,"POST"),f.done(function(a){return h.resolve(a)}),f.fail(function(a){return"\u60a8\u5df2\u7ecf\u5728\u7533\u8bf7\u8be5\u8ba1\u5212\u6216\u60a8\u5df2\u7ecf\u7533\u8bf7\u8fc7\u8be5\u638c\u67dc\u8ba1\u5212!!"===a.errorText?h.resolve(!0):h.reject(a)}),h},g.prototype.getCampaignList=function(a){var b;return b="http://pub.alimama.com/shopdetail/campaigns.json?oriMemberId="+a+"&_input_charset=utf-8",this.getAliData(b)},g.prototype.getCampaignGoods=function(a,b,c,d){var e;return e="http://pub.alimama.com/campaign/merchandiseDetail.json?campaignId="+a+"&shopkeeperId="+b+"&userNumberId="+c+"&tab=2&omid="+c+"&toPage="+d+"&perPagesize=10&_input_charset=utf-8",this.getAliData(e)},g.prototype.checkLoginStatus=function(){var b,c,d;return c=a.Deferred(),d="http://pub.alimama.com/common/getUnionPubContextInfo.json",b=this.getAliData(d),b.fail(function(a){return c.reject(a)}),b.done(function(a){return function(a){return a.memberid&&a.memberid>0?c.resolve(!0):c.resolve(!1)}}()),c},g.prototype.getPvid=function(b){var c,d;return c=a.Deferred(),d="https://temai.taobao.com/event"+b+".htm",a.ajax(d,{dataType:"html",error:function(a){return c.reject(a)},success:function(a){var b;return b=/pvid=([0-9_.]+)/.exec(a),null!=b?void c.resolve(b[1]):c.resolve("")}}),c},g.prototype.getQueQiaoUrlList=function(b,d){var e,f,g;return f=a.Deferred(),g="http://temai.taobao.com/event/items.json?toPage=1&perPageSize=20000&catId=&tagId=&pid="+d+"&unid=&platformType=&isPreview=0&id="+b,c.log("bgID:"+g),e=this.getAliData(g),e.fail(function(a){return f.reject(a)}),e.done(function(a){return function(a){return a.result&&a.result.length>0?f.resolve(a.result):f.resolve(null)}}()),f},g.prototype.applyMagpie=function(b,c){var d,e,f,g,h;return f=a.Deferred(),h="http://pub.alimama.com/event/publish.json",g=/mm_(\d+)_(\d+)_(\d+)/i.exec(c),e={eventId:b,siteId:g[2],adzoneId:g[3],pvid:"",_tb_token_:this.token},d=this.getAliData(h,e,"POST"),d.fail(function(a){return f.reject(a)}),d.done(function(a){return function(a){return a.result?f.resolve(a.result):f.resolve(null)}}()),f},g.prototype.generateMagpie=function(b,c,d){var e,f,g;return f=a.Deferred(),g="http://pub.alimama.com/common/code/getAuctionCode.json?auctionid="+b+"&adzoneid="+d+"&siteid="+c+"&scenes=3&channel=tk_qqhd&_tb_token_="+this.token,e=this.getAliData(g),e.fail(function(a){return f.reject(a)}),e.done(function(a){return function(a){return a?f.resolve(a):f.resolve(null)}}()),f},g.prototype.collectGoods=function(b){var c,d;return d=a.Deferred(),b="http://pub.alimama.com/pubauc/searchAuctionList.json?"+b,c=this.getAliData(b),c.fail(function(a){return d.reject(a)}),c.done(function(a){return function(a){return a.pagelist&&a.pagelist.length>0?d.resolve(a):d.resolve(null)}}()),d},g.prototype.getUnionContextInfo=function(){var b,c,f;return c=a.Deferred(),f="http://pub.alimama.com/common/getUnionPubContextInfo.json",b=this.getAliData(f),b.fail(function(a){return c.reject(a)}),b.done(function(a){return function(a){return a.noLogin?(d.isLoginAlimama&&(d.tkMemberId=null,d.tkRank=null,d.tkNickname=null,d.pidList=[]),c.reject({errorCode:e.ERROR_ALIMAMA_LOGOUT,errorText:'\u6ca1\u6709\u767b\u5f55\u6dd8\u5b9d\u8054\u76df\u6216\u5df2\u9000\u51fa\u6dd8\u5b9d\u8054\u76df\u3002<br/><a target="_blank" href="http://www.alimama.com/member/login.htm">\u70b9\u6211\u53bb\u767b\u5f55\u6dd8\u5b9d\u8054\u76df</a>'}),!1):c.resolve(a)}}()),c},g.prototype.getAppliedCampaign=function(b){var c,d,e;return d=a.Deferred(),e="http://pub.alimama.com/campaign/joinedCampaigns.json?toPage=1&nickname="+encodeURIComponent(b)+"&perPageSize=40&&_tb_token_="+this.token+"&_input_charset=utf-8",c=this.getAliData(e),c.fail(function(a){return d.reject(a)}),c.done(function(a){return d.resolve(a)}),d},g.prototype.getUnionAccountInfo=function(){var b,c,d;return c=a.Deferred(),d="http://pub.alimama.com/overview/unionaccountinfo.json?_tb_token_="+this.token+"&_input_charset=utf-8",b=this.getAliData(d),b.fail(function(a){return c.reject(a)}),b.done(function(a){return c.resolve(a)}),c},g.prototype.getActivityTags=function(b){var c,d,e;return d=a.Deferred(),e="http://pub.alimama.com/event/items.json?eventId="+b+"&toPage=1&tagId=-1&perPageSize=10&catId=-1&auditStatus=-1&areaTagId=-1&rootCatIds=&q=&orderType=&_tb_token_="+this.token+"&_input_charset=utf-8",c=this.getAliData(e),c.fail(function(a){return d.reject(a)}),c.done(function(a){return d.resolve(a.areaTags)}),d},g.prototype.setActivityGoodsTag=function(c,d,e,f){var g,h,i,j;return i=a.Deferred(),j="http://pub.alimama.com/event/itemsAudit.json",h={auditStatus:c,areaTagId:e,eventId:f,_tb_token_:this.token},b.isArray(d)?h.itemIds=d.join(","):h.itemIds=d,g=this.getAliData(j,h,"post"),g.fail(function(a){return i.reject(a)}),g.done(function(a){return i.resolve(a)}),i},g.prototype.getMagpieDetail=function(b){var c,d,e;return d=a.Deferred(),e="http://pub.alimama.com/event/detail.json?eventId="+b+"&_tb_token_="+this.token+"&_input_charset=utf-8",c=this.getAliData(e),c.fail(function(a){return d.reject(a)}),c.done(function(a){return d.resolve(a)}),d},g.prototype.exitCampaign=function(b){var c,d,e,f;return f="http://pub.alimama.com/campaign/exitCampaign.json",d={pubCampaignid:b,t:(new Date).getTime(),pvid:"",_tb_token_:this.token},e=a.Deferred(),c=this.getAliData(f,d,"POST"),c.done(function(a){return e.resolve(a)}),c.fail(function(a){return e.reject(a)}),e},g.prototype.getAppliedCampaignList=function(b,c){var d,e,f;return e=(new Date).getTime(),d=a.Deferred(),f="http://pub.alimama.com/campaign/joinedCampaigns.json?toPage="+b+"&perPageSize="+c+"&t="+e+"&_tb_token_="+this.token+"&_input_charset=utf-8",a.get(f).then(function(a){return d.resolve(a.data),d},function(a){return d.reject(a),d})},g.prototype.getAppliedCampaignStatus=function(b,c){var d,e,f,g;return f=(new Date).getTime(0),e=a.Deferred(),g="http://pub.alimama.com/campaign/campaignDetail.json?campaignId="+b+"&shopkeeperId="+c+"&t="+f+"&_tb_token_="+this.token+"&_input_charset=utf-8",d=this.getAliData(g),d.fail(function(a){return e.reject(a)}),d.done(function(a){return e.resolve(a)}),e},g.prototype.getHidePlanInformation=function(b,c){var d,e,f,g;return f=(new Date).getTime(0),e=a.Deferred(),g="http://pub.alimama.com/campaign/campaignDetail.json?campaignId="+b+"&shopkeeperId="+c+"&t="+f+"&pvid=&_tb_token_="+this.token+"&_input_charset=utf-8",d=this.getAliData(g),d.fail(function(a){return e.reject(a)}),d.done(function(a){return e.resolve(a)}),e},g.prototype.getPublishMaterials=function(b){var c,d,e;return d=a.Deferred(),e="http://pub.alimama.com/shopdetail/publishMaterials.json?oriMemberId="+b+"&_tb_token_="+this.token+"&_input_charset=utf-8",c=this.getAliData(e),c.fail(function(a){return d.reject(a)}),c.done(function(a){return d.resolve(a)}),d},g.prototype.getCampaigns=function(b){var c,d,e;return d=a.Deferred(),e="http://pub.alimama.com/pubauc/getCommonCampaignByItemId.json?itemId="+b+"&_tb_token_="+this.token+"&_input_charset=utf-8",c=this.getAliData(e),c.fail(function(a){return d.reject(a)}),c.done(function(a){return d.resolve(a)}),d},g.prototype._calcSign=function(a,b,c){var d;return d=(this.h5||"").split("_")[0]||null,md5(d+"&"+c+"&"+b+"&"+a)},g.prototype._calcSign2=function(b,c,d){var e,f;return f=a.Deferred(),e=this.getH5TKCookie(),e.done(function(a){var e;return e=(a||"").split("_")[0]||null,f.resolve({sg:md5(e+"&"+d+"&"+c+"&"+b),h5:e})}),e.fail(function(){return f.reject(null)}),f},g.prototype.getH5TKCookie=function(){var b,c;return c=a.Deferred(),b=this.getTaoBaoCookie("_m_h5_tk"),b.done(function(a){return c.resolve(a.value)}),b.fail(function(){return c.reject(null)}),c},g.prototype.getTaoBaoCookie=function(b){var c;return c=a.Deferred(),chrome.cookies.getAll({url:"http://taobao.com/",name:b},function(a){return a.length>0?c.resolve(a[0]):c.reject(null)}),c},g.prototype.getRandIp=function(){return c.getRandInt(100,250)+"."+c.getRandInt(1,254)+"."+c.getRandInt(1,254)+"."+c.getRandInt(1,254)},g.prototype.getCouponDetail=function(b,c){var d,e,f,g,h;return this,g=a.Deferred(),f='{"uuid":"'+c+'","sellerId":"'+b+'","queryShop":true}',d=12574478,h=(new Date).getTime(),e=this._calcSign2(f,d,h),e.done(function(c){var e,i;return e="mtop.taobao.couponMtopReadService.findShopBonusActivitys&v=2.0",i="https://api.m.taobao.com/h5/mtop.taobao.couponmtopreadservice.findshopbonusactivitys/2.0/?",i=i+"appKey="+d+"&t="+h+"&sign="+c.sg+"&api="+e+"&AntiFlood=false&ecode=0&type=jsonp&dataType=jsonp&callback=mtopjsonp2&data="+f,a.ajax(i,{dataType:"text",success:function(a){var c,d,e,f,h,i;return h=!1,null!==/SESSION\u5931\u6548/.exec(a)?g.resolve(h):(e=/^mtopjsonp\d*\((.*)\)$/.exec(a),c=JSON.parse(e[1]),i=/\d{4}-\d{2}-\d{2}/.exec(c.data.module[0].startTime),d=/\d{4}-\d{2}-\d{2}/.exec(c.data.module[0].endTime),f="0"===c.data.module[0].personLimitCount?"\u4e0d\u9650":c.data.module[0].personLimitCount+"\u5f20",h={status:c.data.module[0].status,totalCount:c.data.module[0].totalCount,name:c.data.module[0].activityName,man:Number(c.data.module[0].startFee/100),jian:Number(c.data.module[0].discount/100),sheng:Number(c.data.module[0].totalCount-c.data.module[0].appliedCount),yiLing:Number(c.data.module[0].appliedCount),xianling:f,startDate:i[0],endDate:d[0],sellerId:b,activityId:c.data.module[0].uuid},g.resolve(h))},error:function(a){return g.reject(a)}})}),e.fail(function(){return g.reject("fail")}),g},g.prototype.getShopCoupon=function(b,c){var d,e,f,g,h,i;return this,f=a.Deferred(),e='{"sellerId":"'+b+'"}',d=12574478,h=(new Date).getTime(),g=this._calcSign(e,d,h),i="https://api.m.taobao.com/rest/h5ApiUpdate.do?type=json&api=mtop.shop.querybuyerbonus&v=2.0&data=",i+="%7B%22sellerId%22%3A%22"+b+"%22%7D&type=get&dataType=json&appKey="+d,i+="&t="+h+"&sign="+g,a.ajax(i,{dataType:"json",error:function(a){return f.reject(a)},success:function(a){return/^FAIL_SYS_TOKEN/i.test(a.ret[0])?void f.resolve("FAIL_SYS_TOKEN"):"SUCCESS::\u8c03\u7528\u6210\u529f"!==a.ret[0]?void f.reject("api return fail"):f.resolve(a.data.result)}}),f},g.prototype.getTaoKouLingFrom2in1=function(b,c){var d,e,f,g,h,i;return this,f=a.Deferred(),e={url:b,passwordType:"tao",sourceType:"other",title:c,bizId:"mama-taobaolianmeng"},e=JSON.stringify(e),d=12574478,h=(new Date).getTime(),g=this._calcSign(e,d,h),i="http://api.m.taobao.com/h5/mtop.taobao.wireless.share.password.getpasswordshareinfo/1.0/",a.ajax(i,{dataType:"json",data:{v:"1.0",api:"mtop.taobao.wireless.share.password.getpasswordshareinfo",appKey:d,t:h,type:"json",sign:g,data:e},error:function(a){return f.reject(a)},success:function(a){return"SUCCESS::\u8c03\u7528\u6210\u529f"!==a.ret[0]?void f.reject("api return fail"):f.resolve(a.data)}}),f},g.prototype.getPidFromAlimama=function(){var b,c,d,e;return c=a.Deferred(),d=(new Date).getTime(),e="http://pub.alimama.com/common/adzone/adzoneManage.json?&tab=3&toPage=1&perPageSize=40&gcid=8&t="+d+"&pvid=&_tb_token_="+this.token+"&_input_charset=utf-8",b=this.getAliData(e),b.fail(function(a){return c.reject(a)}),b.done(function(a){return c.resolve(a)}),c},g}()});